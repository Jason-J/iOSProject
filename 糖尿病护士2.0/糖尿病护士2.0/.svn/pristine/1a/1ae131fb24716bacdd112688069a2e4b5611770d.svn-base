//
//  HomeView.m
//  ShowProduct
//
//  Created by lin on 14-5-22.
//  Copyright (c) 2014年 @"". All rights reserved.
//

#import "HomeView.h"
#import "HomeViewCell.h"


#define MENUHEIHT 40

@implementation HomeView

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
        [self commInit];
    }
    return self;
}

#pragma mark UI初始化
-(void)commInit{
    NSArray *vButtonItemArray = @[@{NOMALKEY: @"normal.png",
                                    HEIGHTKEY:@"helight.png",
                                    TITLEKEY:@"运动",
                                    TITLEWIDTH:[NSNumber numberWithFloat:320/5]
                                    },
                                  @{NOMALKEY: @"normal.png",
                                    HEIGHTKEY:@"helight.png",
                                    TITLEKEY:@"饮食",
                                    TITLEWIDTH:[NSNumber numberWithFloat:320/5]
                                    },
                                  @{NOMALKEY: @"normal",
                                    HEIGHTKEY:@"helight",
                                    TITLEKEY:@"健康",
                                    TITLEWIDTH:[NSNumber numberWithFloat:320/5]
                                    },
                                  @{NOMALKEY: @"normal",
                                    HEIGHTKEY:@"helight",
                                    TITLEKEY:@"养生",
                                    TITLEWIDTH:[NSNumber numberWithFloat:320/5]
                                    },
                                  @{NOMALKEY: @"normal",
                                    HEIGHTKEY:@"helight",
                                    TITLEKEY:@"专题",
                                    TITLEWIDTH:[NSNumber numberWithFloat:320/5]
                                    }

                                  ];
    
    if (mMenuHriZontal == nil) {
        mMenuHriZontal = [[MenuHrizontal alloc] initWithFrame:CGRectMake(0, 0, self.frame.size.width, MENUHEIHT) ButtonItems:vButtonItemArray];
        mMenuHriZontal.delegate = self;
    }
    //初始化滑动列表
    if (mScrollPageView == nil) {
        mScrollPageView = [[ScrollPageView alloc] initWithFrame:CGRectMake(0, MENUHEIHT, self.frame.size.width, self.frame.size.height - MENUHEIHT)];
        mScrollPageView.delegate = self;
    }
    [mScrollPageView setContentOfTables:vButtonItemArray.count];
    //默认选中第一个button
    [mMenuHriZontal clickButtonAtIndex:0];
       //-------
    [self addSubview:mScrollPageView];
    [self addSubview:mMenuHriZontal];
}

#pragma mark 内存相关
-(void)dealloc{
    [mMenuHriZontal release],mMenuHriZontal = nil;
    [mScrollPageView release],mScrollPageView = nil;
    [super dealloc];
}

#pragma mark - 其他辅助功能
#pragma mark MenuHrizontalDelegate
-(void)didMenuHrizontalClickedButtonAtIndex:(NSInteger)aIndex{
    NSLog(@"第%ld个Button点击了",(long)aIndex);
    mScrollPageView.p = 1;
    [mScrollPageView moveScrollowViewAthIndex:aIndex];
}

#pragma mark ScrollPageViewDelegate
-(void)didScrollPageViewChangedPage:(NSInteger)aPage{
    NSLog(@"CurrentPage:%ld",(long)aPage);
    [mMenuHriZontal changeButtonStateAtIndex:aPage];
    if (aPage == 0) {
        //刷新当页数据
         mScrollPageView.baseURL = @"http://www.tanghushi.com/api/mobile/?version=2&module=wiki&catid=50&url=1";
    } else if (aPage==1){
         mScrollPageView.baseURL = @"http://www.tanghushi.com/api/mobile/?version=2&module=wiki&catid=47&url=1";
    }else if (aPage==2){
         mScrollPageView.baseURL = @"http://www.tanghushi.com/api/mobile/?version=2&module=wiki&catid=49&url=1";
    } else if (aPage==3){
         mScrollPageView.baseURL = @"http://www.tanghushi.com/api/mobile/?version=2&module=wiki&catid=52&url=1";
    }else if (aPage==4){
         mScrollPageView.baseURL = @"http://www.tanghushi.com/api/mobile/?version=2&module=wiki&catid=53&url=1";
    }
    mScrollPageView.p=1;
     [mScrollPageView freshContentTableAtIndex:aPage];
    [mScrollPageView subjectsRequest];
    
}


@end
