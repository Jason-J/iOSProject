//
//  JSDatePickerView.m
//  TangNiaoBingHuShi
//
//  Created by Jason on 14-12-1.
//  Copyright (c) 2014年 Jason. All rights reserved.
//

#import "JSDatePickerView.h"

@implementation JSDatePickerView

/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect {
    // Drawing code
}
*/

- (instancetype)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        self.backgroundColor = [UIColor whiteColor];

        _datePicker = [[UIDatePicker alloc] initWithFrame:CGRectMake(frame.origin.x, 20 , frame.size.width, frame.size.height)];
        
        [self addSubview:_datePicker];
        
        UIButton *confirmBtn = [UIButton buttonWithType:UIButtonTypeSystem];
        confirmBtn.frame = CGRectMake(frame.size.width - 60, 0, 60, 40);
        [confirmBtn setTitle:@"确认" forState:UIControlStateNormal];
        confirmBtn.titleLabel.font = [UIFont systemFontOfSize:18];
        [confirmBtn addTarget:self action:@selector(confirmBtnAction:) forControlEvents:UIControlEventTouchUpInside];
        confirmBtn.tintColor = RGB(75, 193, 210);
        [self addSubview:confirmBtn];
        
        UIButton *backBtn = [UIButton buttonWithType:UIButtonTypeSystem];
        backBtn.frame = CGRectMake(0, 0, 60, 40);
        [backBtn setTitle:@"返回" forState:UIControlStateNormal];
        backBtn.titleLabel.font = [UIFont systemFontOfSize:18];
        backBtn.tintColor = RGB(75, 193, 210);

        [backBtn addTarget:self action:@selector(bankBtnAction:) forControlEvents:UIControlEventTouchUpInside];
        [self addSubview:backBtn];
    }
    return self;
}


+(JSDatePickerView *)datePickerViewInstance
{
    static JSDatePickerView *pickerView = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        pickerView = [[self alloc] initWithFrame:CGRectMake(0, [UIScreen mainScreen].bounds.size.height, [UIScreen mainScreen].bounds.size.width, SCREEN_HEIGHT / 2
                                                            )];
    });
    return pickerView;
}
-(void)valueOfDate:(SEROW)dateBlock
{
    self.dateBlock = dateBlock;
}
-(void)valueOfCurrentStr:(SELECTEDROW)block
{
    self.currentBlock = block;
}
#pragma mark - 取消按钮方法
-(void)bankBtnAction:(UIButton *)button
{
    [self cancleView];
}
#pragma mark - 确认按钮方法
-(void)confirmBtnAction:(UIButton *)button
{
 
    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];

    [formatter setDateFormat:@"YYYY-MM-dd"];
    _selectedStr = [formatter stringFromDate:_datePicker.date];
    if (self.currentBlock) {
        self.currentBlock(_selectedStr);
    }
    if (self.dateBlock) {
        self.dateBlock(_datePicker.date,_selectedStr);
    }
    NSLog(@"%@", _selectedStr);
    [self cancleView];
}
-(void)showInView:(UIView *)view
{
    [view addSubview:self];
    [UIView animateWithDuration:0.3 animations:^{
        self.frame = CGRectMake(self.frame.origin.x, view.frame.size.height - self.frame.size.height, self.frame.size.width, self.frame.size.height);
    }];
    
}

-(void)cancleView
{
    [UIView animateWithDuration:0.3 animations:^{
        self.frame = CGRectMake(self.frame.origin.x, self.frame.origin.y + self.frame.size.height, self.frame.size.width, self.frame.size.height);
    } completion:^(BOOL finished) {
        [self removeFromSuperview];
    }];
}
@end
