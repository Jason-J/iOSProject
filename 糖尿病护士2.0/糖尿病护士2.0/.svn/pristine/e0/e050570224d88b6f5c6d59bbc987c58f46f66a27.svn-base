//
//  ResultViewController.m
//  TangNiaoBingHuShi
//
//  Created by qimingfang-dwk on 14/11/28.
//  Copyright (c) 2014年 Jason. All rights reserved.
//

#import "ResultViewController.h"
#import "AFNetworking.h"

@interface ResultViewController (){
    UIImageView * hearIV;
    UILabel * nameLab;
    UILabel * valueLab;
    UILabel * contentLab;
    UIScrollView * scrollView;
    
}

@end

@implementation ResultViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    [self resultRequest];
    scrollView = [[UIScrollView alloc] init];
    hearIV = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, 200)];
    hearIV.backgroundColor = [UIColor orangeColor];
    [scrollView addSubview:hearIV];
    nameLab = [[UILabel alloc]initWithFrame:CGRectMake(20, hearIV.frame.size.height, 300, 60)];
//    nameLab.backgroundColor = [UIColor redColor];
    [nameLab setFont:[UIFont fontWithName:nil size:20]];
     [scrollView addSubview:nameLab];
    valueLab = [[UILabel alloc]initWithFrame:CGRectMake(10, hearIV.frame.size.height+nameLab.frame.size.height, 310, 40)];
    [valueLab setFont:[UIFont fontWithName:nil size:18]];
//    valueLab.backgroundColor = [UIColor blueColor];
    [scrollView addSubview:valueLab];
    contentLab = [[UILabel alloc] initWithFrame:CGRectMake(10, hearIV.frame.size.height+nameLab.frame.size.height+valueLab.frame.size.height, 300, 0)];
    [contentLab setNumberOfLines:0];
//    contentLab.backgroundColor = [UIColor yellowColor];
    
    [scrollView addSubview:contentLab];
    scrollView.backgroundColor = [UIColor whiteColor];

 [scrollView setFrame:CGRectMake(0, 0,SCREEN_WIDTH,SCREEN_HEIGHT)];
    
//    [scrollView setContentSize:CGSizeMake(SCREEN_WIDTH, hearIV.frame.size.height+nameLab.frame.size.height+contentLab.frame.size.height+valueLab.frame.size.height)];

    if (hearIV.frame.size.height+nameLab.frame.size.height+contentLab.frame.size.height+valueLab.frame.size.height<SCREEN_HEIGHT) {
        
        [scrollView setContentSize:CGSizeMake(0, SCREEN_HEIGHT)];
    } else{
        [scrollView setContentSize:CGSizeMake(SCREEN_WIDTH, hearIV.frame.size.height+nameLab.frame.size.height+contentLab.frame.size.height+valueLab.frame.size.height)];

    }
       [self.view addSubview:scrollView];

}
#pragma mark - 搜索结果
- (void)resultRequest{

        NSString * string = [NSString stringWithFormat:@"http://test.tanghushi.com/api/mobile/?version=2&module=search&op=search&autoid=%@&tag=%@&add=yes",self.aid,self.tag];
        NSURL * url = [NSURL URLWithString:string];
        NSURLRequest * request = [NSURLRequest requestWithURL:url];
        AFHTTPRequestOperation * operation = [[AFHTTPRequestOperation alloc] initWithRequest:request];
        [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) {
            NSString *requestTmp = [NSString stringWithString:operation.responseString];
            NSData *resData = [[NSData alloc] initWithData:[requestTmp dataUsingEncoding:NSUTF8StringEncoding]];
            
            id object = [NSJSONSerialization JSONObjectWithData:resData options:NSJSONReadingMutableLeaves error:nil];
   
            NSDictionary * dic = [[object objectForKey:@"Variables"] objectForKey:@"value"];
            if ([self.tag isEqualToString:@"diet"]) {
                [nameLab setText:[dic objectForKey:@"name"]];
                if ([dic objectForKey:@"heat"]!=nil) {
                    NSString * str = [NSString stringWithFormat:@" : %@",[dic objectForKey:@"heat"]];
                    NSString * value = [[dic objectForKey:@"heat_name"] stringByAppendingString:str];
                    [valueLab setText:value];
                }
                [contentLab setText:[dic objectForKey:@"class_name"]];
                [contentLab sizeToFit];
                
            }
            if ([self.tag isEqualToString:@"medicine"]) {
                [nameLab setText:[dic objectForKey:@"name"]];
                if ([[dic objectForKey:@"heat"]isEqualToString:@""]==NO) {
                    NSString * str = [NSString stringWithFormat:@" : %@",[dic objectForKey:@"heat"]];
                    NSString * value = [[dic objectForKey:@"heat_name"] stringByAppendingString:str];
                    [valueLab setText:value];
                }

                [contentLab setText:[dic objectForKey:@"desc"]];
                [contentLab sizeToFit];
                
            }
            if ([self.tag isEqualToString:@"sport"]) {
                
            }
        } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
            NSLog(@"error== %@",error);
        }];
        [operation start];
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
