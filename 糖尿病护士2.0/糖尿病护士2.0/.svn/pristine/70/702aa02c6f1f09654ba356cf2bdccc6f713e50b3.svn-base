//
//  PersonalCenterViewController.m
//  TangNiaoBingHuShi
//
//  Created by qimingfang-dwk on 14/12/2.
//  Copyright (c) 2014年 Jason. All rights reserved.
//

#import "PersonalCenterViewController.h"
#import "User.h"
#import "AFHTTPRequestOperationManager.h"

@interface PersonalCenterViewController ()<UITextFieldDelegate>
@property (weak, nonatomic) IBOutlet UIScrollView *scrollView;

@property (weak, nonatomic) IBOutlet UITextField *nameTF;
@property (weak, nonatomic) IBOutlet UITextField *sexTF;
@property (weak, nonatomic) IBOutlet UITextField *heightTF;
@property (weak, nonatomic) IBOutlet UITextField *weightTF;
@property (weak, nonatomic) IBOutlet UITextField *field2TF;

@property (weak, nonatomic) IBOutlet UITextField *field1TF;
@property (weak, nonatomic) IBOutlet UITextField *areaTF;
@property (weak, nonatomic) IBOutlet UITextField *IDNumberTF;
@property (weak, nonatomic) IBOutlet UIButton *saveBtn;

@end
@implementation PersonalCenterViewController

-(void)viewDidLayoutSubviews
{
    [super viewDidLayoutSubviews];
      _scrollView.frame = CGRectMake(0, -64, SCREEN_WIDTH, SCREEN_HEIGHT + 64);
}
- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    User * user = [User shareInstance];
    
    
    
    self.nameTF.delegate = self;
    self.sexTF.delegate = self;
    self.heightTF.delegate = self;
    self.weightTF.delegate = self;
    self.field1TF.delegate = self;
    self.field2TF.delegate = self;
    self.areaTF.delegate = self;
    self.IDNumberTF.delegate = self;
    //获得用户信息
    self.nameTF.text = user.realname;
  
    if ([user.gender intValue]==0) {
        self.sexTF.text = @"未知";
    } else if ([user.gender intValue]==1){
        self.sexTF.text = @"男";
    } else{
        self.sexTF.text = @"女";
    }
    self.heightTF.text = user.height;
    self.weightTF.text = user.weight;
    self.field1TF.text = user.field1;
    self.field2TF.text = user.field2;
    self.areaTF.text = user.residesuite;
    self.IDNumberTF.text = user.idcard;
}
#pragma mark - request
- (void)saveRequest{
    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];
    manager.responseSerializer.acceptableContentTypes = [NSSet setWithObject:@"text/html"];
    NSString * sexStr = [NSString string];
    if ([self.sexTF.text isEqualToString:@"男"]) {
        sexStr = @"1";
    } else if ([self.sexTF.text isEqualToString:@"女"]){
        sexStr = @"2";
    } else{
        sexStr = @"0";
    }
    
//    NSDictionary * dictionary = @{@"realname":self.nameTF.text,@"gender":sexStr,@"height":self.heightTF.text,@"weight":self.weightTF.text,@"field1":self.field1TF.text,@"field2":self.field2TF.text,@"residesuite":self.areaTF.text,@"idcard":self.IDNumberTF.text};
    [manager POST:@"http://test.tanghushi.com/api/mobile/?version=2&module=userinfo&op=edit" parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) {
        id value = [[responseObject objectForKey:@"Variables"] objectForKey:@"value"];
        NSNumberFormatter* numberFormatter = [[NSNumberFormatter alloc] init];
        NSString * str = [numberFormatter stringFromNumber:value];
        if ([str isEqualToString:@"1"]) {
            [FVCustomAlertView showDefaultDoneAlertOnView:self.view withTitle:@"恭喜您，修改成功!"];
        }else{
            [FVCustomAlertView showDefaultErrorAlertOnView:self.view withTitle:@"修改失败"];
        }
    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {
        NSLog(@"修改失败");
        [FVCustomAlertView showDefaultErrorAlertOnView:self.view withTitle:@"修改失败"];
    }];
}
- (IBAction)saveAction:(id)sender {
    [self saveRequest];
}
-(void)textFieldDidBeginEditing:(UITextField *)textField{   //开始编辑时，整体上移

//    if (textField==self.IDNumberTF||textField==self.areaTF||textField==self.field1TF) {
//        [self moveView:-216];
//    }

//    
//    if (textField==self.IDNumberTF||textField==self.areaTF||textField==self.field1TF) {
//        [self moveView:-216];
//    }
    _scrollView.contentSize = CGSizeMake(SCREEN_WIDTH, SCREEN_HEIGHT + SCREEN_HEIGHT / 2 - 60);
      _scrollView.contentOffset = CGPointMake(0, textField.frame.origin.y-216);

}
-(void)textFieldDidEndEditing:(UITextField *)textField{     //结束编辑时，整体下移
//    if (textField==self.IDNumberTF||textField==self.areaTF||textField==self.field1TF) {
//        [self moveView:216];
//    }
  
    _scrollView.contentSize = CGSizeMake(SCREEN_WIDTH, SCREEN_HEIGHT);
       _scrollView.contentOffset = CGPointMake(0, textField.frame.origin.y+216);

}
-(void)moveView:(float)move{
    NSTimeInterval animationDuration = 0.30f;
    CGRect frame = self.view.frame;
    frame.origin.y +=move;//view的X轴上移
    self.view.frame = frame;
    [UIView beginAnimations:@"ResizeView" context:nil];
    [UIView setAnimationDuration:animationDuration];
    self.view.frame = frame;
    [UIView commitAnimations];//设置调整界面的动画效果
}
-(BOOL)textFieldShouldReturn:(UITextField *)textField{
    [textField resignFirstResponder];
    return YES;
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
