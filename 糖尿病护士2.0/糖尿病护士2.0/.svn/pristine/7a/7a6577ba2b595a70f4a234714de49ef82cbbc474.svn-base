//
//  CollectViewController.m
//  TangNiaoBingHuShi
//
//  Created by qimingfang-dwk on 14/12/8.
//  Copyright (c) 2014年 Jason. All rights reserved.
//

#import "CollectViewController.h"
#import "HMSegmentedControl.h"
#import "Subjects.h"
#import "HomeViewCell.h"
#import "SubjectsDetailsViewController.h"
@interface CollectViewController ()<UITableViewDataSource,UITableViewDelegate>{
    NSMutableArray * tableArray;
}
@property (nonatomic,strong)HMSegmentedControl *sg;
@property (nonatomic,strong)NSString * catid;
@property (nonatomic,strong) UITableView * tableView;
@end

@implementation CollectViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    tableArray = [[NSMutableArray alloc] init];
    self.view.backgroundColor = [UIColor whiteColor];
   
    self.sg = [[HMSegmentedControl alloc] initWithSectionTitles:@[@"运动",@"饮食",@"健康",@"养生",@"专题"]];
    __weak typeof(self) weakSelf=self;
    [weakSelf.sg setIndexChangeBlock:^(NSUInteger index) {
//        NSLog(@"Selected index %lu (via block)", (unsigned long)index);
        switch (index) {
            case 0:
            {
                NSLog(@"运动,%s",__func__);
               weakSelf.catid = @"50";
            }
                break;
                case 1:
            {
                NSLog(@"饮食,%s",__func__);
                 weakSelf.catid = @"47";
            }
                break;
                case 2:
            {
                NSLog(@"健康,%s",__func__);
                weakSelf.catid = @"49";
            }
                break;
                case 3:
            {
                NSLog(@"养生,%s",__func__);
                weakSelf.catid = @"52";
            }
                break;
                case 4:
            {
                NSLog(@"专题,%s",__func__);
                weakSelf.catid = @"53";
            }
                break;
            default:
                break;
        }
        [self getArticleRequest];
    }];
    [self.sg setFrame:CGRectMake(0, 64, 320, 40)];
    [self.sg setSelectionIndicatorHeight:4.0f];
    [self.sg setBackgroundColor:[UIColor grayColor]];
    [self.sg setTextColor:[UIColor blackColor]];
    [self.sg setSelectionIndicatorColor:[UIColor cyanColor]];
    [self.sg setSelectionIndicatorMode:HMSelectionIndicatorFillsSegment];
    [self.sg setSegmentEdgeInset:UIEdgeInsetsMake(0, 6, 0, 6)];
//    [segmentedControl2 setCenter:CGPointMake(160, 120)];
    [self.sg setTag:1];
    [self.view addSubview:self.sg];
    self.sg.selectedIndex=0;
    
    
    self.tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, self.sg.frame.size.height+64, SCREEN_WIDTH, SCREEN_HEIGHT) style:UITableViewStylePlain];
    [self.view addSubview:self.tableView];
    self.tableView.rowHeight = 140;
    self.tableView.delegate = self;
    self.tableView.dataSource = self;
}
- (void)segmentedControlChangedValue:(HMSegmentedControl *)segmentedControl {
    NSLog(@"Selected index %li (via UIControlEventValueChanged)", (long)segmentedControl.selectedIndex);
}
#pragma mark - request
- (void)getArticleRequest{
    [FVCustomAlertView showDefaultLoadingAlertOnView:self.view withTitle:@"加载中.."];
    JSNetWorking * js = [[JSNetWorking alloc] init];
    NSString * url = [NSString stringWithFormat:@"http://test.tanghushi.com/api/mobile/?version=2&module=wiki&op=favoritelist&catid=%@",_catid];
    NSLog(@"url-=-=%@",url);
    [js getRequestWithURLStr:url success:^(id ResultData) {
        id value = [[ResultData objectForKey:@"Variables"] objectForKey:@"value"];
        NSArray * array = [value objectForKey:@"data"];
        [tableArray removeAllObjects];
        if (array.count!=0) {
            for (NSDictionary * dic in array) {
                Subjects * subject = [[Subjects alloc] init];
                subject.aid = [dic objectForKey:@"aid"];
                subject.dateline = [dic objectForKey:@"dateline"];
                subject.title = [dic objectForKey:@"title"];
                subject.summary = [dic objectForKey:@"summary"];
                subject.commentnum = [dic objectForKey:@"commentnum"];
                subject.favtimes = [dic objectForKey:@"favtimes"];
                subject.sharetimes = [dic objectForKey:@"sharetimes"];
                subject.images = [dic objectForKey:@"images"];
                [tableArray addObject:subject];
            }
        }else{
            [FVCustomAlertView showDefaultWarningAlertOnView:self.view withTitle:@"没有数据"];
        }
        [_tableView reloadData];
         [FVCustomAlertView hideAlertFromView:self.view fading:YES];
        NSLog(@"value =-=-=-=-=-=-=%@",value);
    } failure:^(NSError *error, AFHTTPRequestOperation *operation) {
        NSLog(@"error == %@",error);
        [FVCustomAlertView showDefaultErrorAlertOnView:self.view withTitle:@"加载失败"];
    }];
    
}
#pragma mark -tableviewdelegate
-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString *vCellIdentify = @"homeCell";
    HomeViewCell *cell = [tableView dequeueReusableCellWithIdentifier:vCellIdentify];
    if (cell == nil) {
        cell = [[[NSBundle mainBundle] loadNibNamed:@"HomeViewCell" owner:self options:nil] lastObject];
    }
    [cell configureForSubjects:[tableArray objectAtIndex:indexPath.row]];
    return cell;
}
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    return tableArray.count;
}
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{
    SubjectsDetailsViewController * subjectsDetailsVC = [[SubjectsDetailsViewController alloc] init];
    Subjects * subject = [tableArray objectAtIndex:indexPath.row];
    subjectsDetailsVC.aaid = subject.aid;
    subjectsDetailsVC.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:subjectsDetailsVC animated:YES];

}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        dispatch_async(dispatch_get_main_queue(), ^{
            
        });
    });
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
