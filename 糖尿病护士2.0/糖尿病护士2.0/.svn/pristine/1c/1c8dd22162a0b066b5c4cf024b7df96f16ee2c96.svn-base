//
//  Certify.m
//  TangNiaoBingHuShi
//
//  Created by qimingfang-dwk on 14/12/23.
//  Copyright (c) 2014年 Jason. All rights reserved.
//

#import "CertifyViewController.h"
#import "MyDoctorTableViewCell.h"


@interface CertifyViewController ()<UITableViewDataSource,UITableViewDelegate>
@property (nonatomic,strong)UITableView *tableView;
@property (nonatomic,strong)Doctor * doc;

@end

@implementation CertifyViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    self.tableView = [[UITableView alloc] initWithFrame:CGRectMake(0,0, SCREEN_WIDTH, SCREEN_HEIGHT) style:UITableViewStylePlain];
    self.tableView.delegate = self;
    self.tableView.dataSource = self;
//    self.tableView.rowHeight = 140;
    [self.view addSubview:self.tableView];
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        [self getdoctorRequest];
        dispatch_async(dispatch_get_main_queue(), ^{
        });
    });
    
    MyDoctorTableViewCell * headerView = [[[NSBundle mainBundle] loadNibNamed:@"MyDoctorTableViewCell" owner:self options:nil] lastObject];
    
    [headerView configureForModel:self.doctor];
    self.tableView.tableHeaderView = headerView;
    self.tableView.tableFooterView = [[UIView alloc] init];//去除空白cell
}
#pragma mark -tableviewdelegate
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    return 1;
}
-(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{
    return 3;
}
-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
     UITableViewCell *cell = [self tableView:tableView cellForRowAtIndexPath:indexPath];
    return cell.frame.size.height+40;
}
-(UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section{
    UIImageView * headerView = [[UIImageView alloc] init];
    headerView.image = [UIImage imageNamed:@"renz_biaotilan_bg"];
    UILabel * label = [[UILabel alloc] initWithFrame:CGRectMake(10, 5, 200, 30)];
    switch (section) {
        case 0:
            label.text = @"擅长诊所介绍";
            break;
        case 1:
            label.text = @"医学教育背景介绍";
            break;
        case 2:
            label.text = @"学术研究成果，获奖介绍";
            break;
        default:
            break;
    }
    [headerView addSubview:label];
    return headerView;
}

-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
    return 45;
}
-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    static NSString * ce = @"142";
    UITableViewCell * cell = [tableView dequeueReusableCellWithIdentifier:ce];
    if (!cell) {
        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:ce];
    }
    switch (indexPath.section) {
        case 0:
            cell.textLabel.text = _doc.speciality;
            break;
            case 1:
            cell.textLabel.text = _doc.graduateschool;
            break;
            case 2:
            cell.textLabel.text = _doc.achievement;
            break;
        default:
            break;
    }
//    cell.textLabel.numberOfLines=0;
//    [cell.textLabel sizeToFit];
    cell.userInteractionEnabled = NO;
        cell.textLabel.font = [UIFont systemFontOfSize:13];
    cell.textLabel.numberOfLines = 0;
    //计算出显示完整内容需要的最小尺寸
    CGSize requiredSize = [cell.textLabel.text sizeWithFont:[UIFont systemFontOfSize:13] constrainedToSize:CGSizeMake(320, 10000) lineBreakMode:NSLineBreakByWordWrapping];
 
    //重新设置自定义Label的frame
    cell.textLabel.frame = CGRectMake(0, 0, requiredSize.width, requiredSize.height);
    CGRect rect = cell.frame;
    rect.size.height = requiredSize.height;
    cell.frame = rect;
    return cell;
}
#pragma mark -request
-(void)getdoctorRequest{
    
    [FVCustomAlertView showDefaultLoadingAlertOnView:self.view withTitle:@"加载中"];
    NSString * url = [CommonSettings baseUrlWithVersion:2 module:@"userinfo" parameters:@{@"op":@"getinfo",@"uid":self.doctor.uid,@"identity":@"2"}];
    JSNetWorking * js = [[JSNetWorking alloc] init];
    [js getRequestWithURLStr:url success:^(id ResultData) {
        id value = [[ResultData objectForKey:@"Variables"] objectForKey:@"value"];
        _doc = [[Doctor alloc] init];
        [_doc setValuesForKeysWithDictionary:value];
        [_tableView reloadData];
        [FVCustomAlertView hideAlertFromView:self.view fading:YES];
    } failure:^(NSError *error, AFHTTPRequestOperation *operation) {
        NSLog(@"error = %@",error);
        [FVCustomAlertView showDefaultErrorAlertOnView:self.view withTitle:@"错误"];
    }];
    
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
 #pragma mark - Navigation
 
 // In a storyboard-based application, you will often want to do a little preparation before navigation
 - (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
 // Get the new view controller using [segue destinationViewController].
 // Pass the selected object to the new view controller.
 }
 */

@end
